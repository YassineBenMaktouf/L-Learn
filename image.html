{% extends "mainfront/base.html" %}

{% block content %}
<div class="row justify-content-center mt-3">
    <div class="col-lg-6 col-md-8 col-sm-10">
        <div class="card mb-2">
            <div class="card-body" >
                <div class="page">
                    <div class="container py-5">
                        <div class="row">
                            <div class="col">
                                <h2 class="card-title text-center mb-4">What does the image represent?</h2>
                                <div id="image_div"></div>
                                <div  class="mt-4 mb-4 d-flex justify-content-center">
                                    <button id="word1" class="btn btn-primary btn-block mr-2" style="margin: 3px;">Loading..</button>
                                    <button id="word2" class="btn btn-primary btn-block mr-2" style="margin: 3px;">Loading..</button>
                                    <button id="word3" class="btn btn-primary btn-block mr-2" style="margin: 3px;">Loading..</button>
                                    <button id="word4" class="btn btn-primary btn-block mr-2" style="margin: 3px;">Loading..</button>
                                </div>
                                <div>
                                    <div id="feedback" class="mt-3 d-flex align-items-center justify-content-center" style="text-align: center;"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    fetch('/generate_image_with_random_word')
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            return response.json();
        })
        .then(data => {
            console.log(data); // Log the response data
            if (data && data.message === 'Image generated successfully') {
                console.log('Received words:', data.words)
                console.log('el kelma',data.object_name)
                
                if (data.words && data.words.length >= 4) {
                    // Update the button texts with the generated words
                    document.getElementById('word1').innerText = data.words[0];
                    document.getElementById('word2').innerText = data.words[1];
                    document.getElementById('word3').innerText = data.words[2];
                    document.getElementById('word4').innerText = data.words[3];
                } else {
                    console.error('Words data is missing or insufficient');
                }
                
            
                // Create a new image element
                const img = document.createElement('img');
                img.src = './static/img/generated_image.png';
                img.classList.add('img-fluid', 'w-100', 'rounded');
                
                // Append the image element to the image_div
                document.getElementById('image_div').appendChild(img);
                // Select all the buttons
    const buttons = document.querySelectorAll('.btn');
    console.log(buttons) 

    // Add click event listeners to each button
    buttons.forEach(button => {
        button.addEventListener('click', () => {
            // Get the text of the clicked button
            const clickedWord = button.innerText;

            
            const correctWord = data.correct_word;
            
                        if (clickedWord === correctWord) {
                            
                            // Display correct feedback
                            document.getElementById('feedback').innerText = 'Correct!';
                            document.getElementById('feedback').classList.add('text-success');
                            document.getElementById('feedback').classList.remove('text-danger');
                        } else {
                            console.log('Incorrect!');
                            // Display incorrect feedback
                            document.getElementById('feedback').innerText = 'Incorrect!';
                            document.getElementById('feedback').classList.add('text-danger');
                            document.getElementById('feedback').classList.remove('text-success');
                        }
                    } 
                )})
            } else {
                console.error('Failed to generate image');
                document.getElementById('feedback').innerText = 'Failed to generate image.';
                document.getElementById('feedback').classList.add('text-danger');
                document.getElementById('feedback').classList.remove('text-success');
            }
        })
        .catch(error => {
            console.error('Error occurred during fetch:', error);
        });
</script>

{% endblock %}